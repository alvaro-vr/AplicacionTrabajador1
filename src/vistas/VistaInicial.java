/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package vistas;

import dao.DAOTrabajador;
import dao.*;
import entidades.Trabajador;
import java.time.LocalDate;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 * Clase que representa la vista inicial de la aplicación. Esta clase se encarga
 * de gestionar la interfaz gráfica principal, incluyendo la tabla de
 * trabajadores y los botones para interactuar con ellos. También se encarga de
 * la interacción con la capa de datos a través del DAO.
 *
 * @author Administrador
 */
public class VistaInicial extends javax.swing.JFrame {

    /**
     * Creates new form VistaInicial
     */
    private final DAOTrabajador dao = new DAOTrabajadoresImpl();
    private final String[] cabeceraTabla = {
        "DNI", "Nombre", "Apedillos", "Sueldo", "Fecha", "Matricula"
    };
    public DefaultTableModel modelo = new DefaultTableModel();

    /**
     * Constructor de la clase. Inicializa los componentes de la interfaz
     * gráfica y establece la ubicación de la ventana.
     */
    public VistaInicial() {
        initComponents();
        setLocationRelativeTo(null);
        prepararTabla();
        rellenarTabla();
    }

    /**
     * Método que prepara el modelo de la tabla.
     */
    public void prepararTabla() {
        modelo = new DefaultTableModel();
        modelo.addColumn("DNI");
        modelo.addColumn("NOMBRE");
        modelo.addColumn("APELLIDOS");
        modelo.addColumn("SUELDO");
        modelo.addColumn("FECHA");
        modelo.addColumn("MATRICULA");
    }

    /**
     * Método que rellena la tabla con los datos de los trabajadores.
     */
    public void rellenarTabla() {
        ArrayList<Trabajador> trabajadores = dao.getAll();
        trabajadores.stream().forEach(trabajador -> {
            ArrayList fila = new ArrayList();
            fila.add(trabajador.getDni());
            fila.add(trabajador.getNombre());
            fila.add(trabajador.getApellidos());
            fila.add(trabajador.getSueldo());
            fila.add(trabajador.getFecha());
            fila.add(trabajador.getMatricula());
            modelo.addRow(fila.toArray());
        });

        tableTrabajadores.setModel(modelo);
    }

    /**
     * Método que actualiza la tabla de trabajadores.
     */
    public void actualizarTabla() {
        prepararTabla();
        rellenarTabla();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        dialogGeneral = new javax.swing.JDialog();
        scrollPanelTabla = new javax.swing.JScrollPane();
        tableTrabajadores = new javax.swing.JTable();
        panelContenedorBotones = new javax.swing.JPanel();
        btnEliminarTrabajador = new javax.swing.JButton();
        btnAñadirTrabajador = new javax.swing.JButton();
        btnModificarTrabajador = new javax.swing.JToggleButton();
        btnFiltrarTrabajador = new javax.swing.JButton();

        javax.swing.GroupLayout dialogGeneralLayout = new javax.swing.GroupLayout(dialogGeneral.getContentPane());
        dialogGeneral.getContentPane().setLayout(dialogGeneralLayout);
        dialogGeneralLayout.setHorizontalGroup(
            dialogGeneralLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        dialogGeneralLayout.setVerticalGroup(
            dialogGeneralLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 300, Short.MAX_VALUE)
        );

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Tabla Trabajadores");

        tableTrabajadores.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {}
            },
            new String [] {

            }
        ));
        scrollPanelTabla.setViewportView(tableTrabajadores);

        panelContenedorBotones.setBorder(javax.swing.BorderFactory.createTitledBorder("Acciones"));

        btnEliminarTrabajador.setText("Eliminar Trabajador");
        btnEliminarTrabajador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarTrabajadorActionPerformed(evt);
            }
        });
        panelContenedorBotones.add(btnEliminarTrabajador);

        btnAñadirTrabajador.setText("Añadir Trabajador");
        btnAñadirTrabajador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAñadirTrabajadorActionPerformed(evt);
            }
        });
        panelContenedorBotones.add(btnAñadirTrabajador);

        btnModificarTrabajador.setText("Modificar Trabajador");
        btnModificarTrabajador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnModificarTrabajadorActionPerformed(evt);
            }
        });
        panelContenedorBotones.add(btnModificarTrabajador);

        btnFiltrarTrabajador.setText("Filtrar Trabajadores");
        btnFiltrarTrabajador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnFiltrarTrabajadorActionPerformed(evt);
            }
        });
        panelContenedorBotones.add(btnFiltrarTrabajador);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(scrollPanelTabla, javax.swing.GroupLayout.DEFAULT_SIZE, 729, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(panelContenedorBotones, javax.swing.GroupLayout.DEFAULT_SIZE, 717, Short.MAX_VALUE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(scrollPanelTabla, javax.swing.GroupLayout.DEFAULT_SIZE, 340, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(panelContenedorBotones, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    /**
     * Método encargado de manejar el evento de eliminación de un trabajador.
     * Verifica si se ha seleccionado una fila en la tabla de trabajadores y, en
     * caso afirmativo, muestra un mensaje de confirmación para eliminar al
     * trabajador. Si el usuario confirma, invoca al método DAO correspondiente
     * para eliminar el trabajador seleccionado y actualiza la tabla.
     *
     * @param evt Evento de acción que desencadena este método.
     */
    private void btnEliminarTrabajadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarTrabajadorActionPerformed
        // TODO add your handling code here:
        if (tableTrabajadores.getSelectedRow() == -1) {
            JOptionPane.showMessageDialog(null, "Debes seleccionar una fila en la tabla para borrar!");
        } else {

            int respuesta = JOptionPane.showConfirmDialog(null, "¿Desea eliminar el trabajador?", "Eliminar", JOptionPane.YES_NO_OPTION);

            if (respuesta == JOptionPane.YES_OPTION) {

                dao.delete(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 0).toString());
            }
        }

        actualizarTabla();
    }//GEN-LAST:event_btnEliminarTrabajadorActionPerformed

    /**
     * Método encargado de manejar el evento de añadir un nuevo trabajador.
     * Muestra un diálogo para ingresar los datos del nuevo trabajador y, una
     * vez añadido, actualiza la tabla de trabajadores para reflejar los
     * cambios.
     *
     * @param evt Evento de acción que desencadena este método.
     */
    private void btnAñadirTrabajadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAñadirTrabajadorActionPerformed
        // TODO add your handling code here:
        dialogGeneral = new dialogNuevoTrabajador(this, rootPaneCheckingEnabled);
        dialogGeneral.setLocationRelativeTo(null);
        dialogGeneral.setVisible(true);
        actualizarTabla();
    }//GEN-LAST:event_btnAñadirTrabajadorActionPerformed

    /**
     * Método encargado de manejar el evento de modificar un trabajador
     * existente. Verifica si se ha seleccionado una fila en la tabla de
     * trabajadores y, en caso afirmativo, muestra un diálogo para modificar los
     * datos del trabajador seleccionado. Una vez realizada la modificación,
     * actualiza la tabla para reflejar los cambios.
     *
     * @param evt Evento de acción que desencadena este método.
     */
    private void btnModificarTrabajadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnModificarTrabajadorActionPerformed
        // TODO add your handling code here:

        if (tableTrabajadores.getSelectedRow() == -1) {
            JOptionPane.showMessageDialog(null, "Debes seleccionar una fila en la tabla para modificar!");
        } else {

            dialogModTrabajador modTrabajador = new dialogModTrabajador(this, rootPaneCheckingEnabled);
            modTrabajador.txtModDni.setText(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 0).toString());
            modTrabajador.txtModNombre.setText(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 1).toString());
            modTrabajador.txtModApellidos.setText(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 2).toString());
            modTrabajador.txtModSueldo.setText(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 3).toString());

            LocalDate fecha = LocalDate.parse(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 4).toString());

            modTrabajador.txtModDia.setText(String.valueOf(fecha.getDayOfMonth()));
            modTrabajador.txtModMes.setText(String.valueOf(fecha.getMonthValue()));
            modTrabajador.txtModAnio.setText(String.valueOf(fecha.getYear()));

            modTrabajador.txtModMatricula.setText(tableTrabajadores.getValueAt(tableTrabajadores.getSelectedRow(), 5).toString());

            dialogGeneral = modTrabajador;
            dialogGeneral.setLocationRelativeTo(null);

            dialogGeneral.setVisible(true);
        }

        actualizarTabla();
    }//GEN-LAST:event_btnModificarTrabajadorActionPerformed

    /**
     * Método encargado de manejar el evento de filtrado de trabajadores. Al ser
     * invocado, muestra un diálogo especializado para filtrar y visualizar
     * trabajadores según diferentes criterios seleccionados por el usuario.
     *
     * @param evt Evento de acción que desencadena este método.
     */
    private void btnFiltrarTrabajadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnFiltrarTrabajadorActionPerformed
        // TODO add your handling code here:
        dialogFiltrarTrabajador filtrarTrabajador = new dialogFiltrarTrabajador(this, rootPaneCheckingEnabled);
        filtrarTrabajador.vistaInicial = this;
        dialogGeneral = filtrarTrabajador;
        dialogGeneral.setLocationRelativeTo(null);
        dialogGeneral.setVisible(true);
    }//GEN-LAST:event_btnFiltrarTrabajadorActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAñadirTrabajador;
    private javax.swing.JButton btnEliminarTrabajador;
    private javax.swing.JButton btnFiltrarTrabajador;
    private javax.swing.JToggleButton btnModificarTrabajador;
    private javax.swing.JDialog dialogGeneral;
    private javax.swing.JPanel panelContenedorBotones;
    private javax.swing.JScrollPane scrollPanelTabla;
    public javax.swing.JTable tableTrabajadores;
    // End of variables declaration//GEN-END:variables
}
